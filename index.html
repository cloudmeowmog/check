<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>匯款對帳查詢系統</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f8f9fa; padding-top: 50px; }
        .container { max-width: 600px; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        .result-box { margin-top: 20px; font-weight: bold; display: none; padding: 15px; border-radius: 5px; }
        .success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .fail { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    </style>
</head>
<body>

<div class="container text-center">
    <h2 class="mb-4">匯款對帳查詢</h2>
    <p>請輸入您的帳號<b>末 5 碼</b>進行查詢：</p>
    
    <div class="input-group mb-3">
        <input type="text" id="accountInput" class="form-control" placeholder="例如：12345" maxlength="5">
        <button class="btn btn-primary" type="button" onclick="checkPayment()">查詢</button>
    </div>

    <div id="result" class="result-box"></div>
    <div class="mt-4 text-muted" style="font-size: 0.9em;">
        資料最後更新時間：<span id="lastModified">載入中...</span>
    </div>
</div>

<script>
    // 定義資料檔案名稱
    const DATA_FILE = 'data.txt';

    async function checkPayment() {
        const input = document.getElementById('accountInput').value.trim();
        const resultBox = document.getElementById('result');

        // 簡單驗證輸入
        if (input.length !== 5 || isNaN(input)) {
            showResult('請輸入正確的 5 碼數字', 'fail');
            return;
        }

        try {
            // 加上時間戳記避免瀏覽器快取舊資料 (?t=...)
            const response = await fetch(DATA_FILE + '?t=' + new Date().getTime());
            
            if (!response.ok) {
                throw new Error('無法讀取對帳資料');
            }

            const text = await response.text();
            // 將文字檔內容切割成陣列 (以換行符號切割)
            const accountList = text.split('\n').map(s => s.trim());

            if (accountList.includes(input)) {
                showResult('✅ 已收到您的款項，謝謝您的支持！', 'success');
            } else {
                showResult('⚠️ 尚未入帳，或對帳資料尚未更新。', 'fail');
            }

        } catch (error) {
            console.error(error);
            showResult('系統錯誤：無法讀取資料庫，請稍後再試。', 'fail');
        }
    }

    function showResult(msg, type) {
        const resultBox = document.getElementById('result');
        resultBox.style.display = 'block';
        resultBox.className = 'result-box ' + type;
        resultBox.innerText = msg;
    }

    // 取得檔案最後修改時間 (Github Pages 上可能不準，但可作為參考)
    fetch(DATA_FILE, {method: 'HEAD'})
        .then(r => {
            const lastMod = r.headers.get('Last-Modified');
            if(lastMod) {
                const date = new Date(lastMod);
                document.getElementById('lastModified').innerText = date.toLocaleString('zh-TW');
            } else {
                document.getElementById('lastModified').innerText = '未知';
            }
        });
</script>

</body>
</html>